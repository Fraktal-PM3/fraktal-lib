{
    "namespace": "default",
    "name": "pm3package",
    "description": "FFI for PM3 PackageContract",
    "version": "1.1",
    "methods": [
        {
            "name": "CreatePackage",
            "pathname": "",
            "description": "Create a package. Transient keys: 'pii' (JSON of PackagePII), 'packageDetails' (JSON of PackageDetails).",
            "params": [
                {
                    "name": "externalId",
                    "schema": {
                        "type": "string"
                    }
                },
                {
                    "name": "recipientOrgMSP",
                    "schema": {
                        "type": "string"
                    }
                }
            ],
            "returns": []
        },
        {
            "name": "ReadBlockchainPackage",
            "pathname": "",
            "description": "Read the public blockchain package data by external ID",
            "params": [
                {
                    "name": "externalId",
                    "schema": {
                        "type": "string"
                    }
                }
            ],
            "returns": [
                {
                    "name": "",
                    "schema": {
                        "type": "string"
                    }
                }
            ]
        },
        {
            "name": "ReadPackageDetailsAndPII",
            "pathname": "",
            "description": "Read the private package details and PII by external ID. Only the owner org (ownerOrgMSP) can read from its implicit collection.",
            "params": [
                {
                    "name": "externalId",
                    "schema": {
                        "type": "string"
                    }
                }
            ],
            "returns": [
                {
                    "name": "",
                    "schema": {
                        "type": "string"
                    }
                }
            ]
        },
        {
            "name": "ReadPrivateTransferTerms",
            "pathname": "",
            "description": "Read private transfer terms from the caller's implicit collection. Supports partial queries - provide empty string for either parameter to query by the other.",
            "params": [
                {
                    "name": "externalId",
                    "schema": {
                        "type": "string"
                    }
                },
                {
                    "name": "termsID",
                    "schema": {
                        "type": "string"
                    }
                }
            ],
            "returns": [
                {
                    "name": "",
                    "schema": {
                        "type": "string"
                    }
                }
            ]
        },
        {
            "name": "ReadPublicProposal",
            "pathname": "",
            "description": "Read public proposal data from the blockchain. Supports partial queries - provide empty string for either parameter to query by the other.",
            "params": [
                {
                    "name": "externalId",
                    "schema": {
                        "type": "string"
                    }
                },
                {
                    "name": "termsID",
                    "schema": {
                        "type": "string"
                    }
                }
            ],
            "returns": [
                {
                    "name": "",
                    "schema": {
                        "type": "string"
                    }
                }
            ]
        },
        {
            "name": "UpdatePackageStatus",
            "pathname": "",
            "description": "Update status (only owner org may update; setting to 'succeeded' additionally requires attribute role=pm3).",
            "params": [
                {
                    "name": "externalId",
                    "schema": {
                        "type": "string"
                    }
                },
                {
                    "name": "status",
                    "schema": {
                        "type": "string",
                        "enum": [
                            "pending",
                            "ready_for_pickup",
                            "picked_up",
                            "in_transit",
                            "delivered",
                            "succeeded",
                            "failed",
                            "proposed"
                        ]
                    }
                }
            ],
            "returns": []
        },
        {
            "name": "DeletePackage",
            "pathname": "",
            "description": "Delete a package (requires role=pm3 anytime, or role=ombud while status is PENDING).",
            "params": [
                {
                    "name": "externalId",
                    "schema": {
                        "type": "string"
                    }
                }
            ],
            "returns": []
        },
        {
            "name": "PackageExists",
            "pathname": "",
            "description": "Check if package exists",
            "params": [
                {
                    "name": "externalId",
                    "schema": {
                        "type": "string"
                    }
                }
            ],
            "returns": [
                {
                    "name": "",
                    "schema": {
                        "type": "boolean"
                    }
                }
            ]
        },
        {
            "name": "ProposeTransfer",
            "pathname": "",
            "description": "Propose a transfer of a package to another org. Only current owner can propose. Transient key required: 'transferTerms' (JSON).",
            "params": [
                {
                    "name": "externalId",
                    "schema": {
                        "type": "string"
                    }
                },
                {
                    "name": "termsID",
                    "schema": {
                        "type": "string"
                    }
                }
            ],
            "returns": []
        },
        {
            "name": "UpdateStatusAfterPropose",
            "pathname": "",
            "description": "Update package status to PROPOSED after proposing a transfer. Creates a proposal record on-chain.",
            "params": [
                {
                    "name": "externalId",
                    "schema": {
                        "type": "string"
                    }
                },
                {
                    "name": "termsID",
                    "schema": {
                        "type": "string"
                    }
                },
                {
                    "name": "toMSP",
                    "schema": {
                        "type": "string"
                    }
                },
                {
                    "name": "expiryISO",
                    "schema": {
                        "type": "string"
                    }
                }
            ],
            "returns": []
        },
        {
            "name": "UpdateStatusAfterAccept",
            "pathname": "",
            "description": "Update package status to READY_FOR_PICKUP after accepting a transfer. Updates proposal status to 'accepted'.",
            "params": [
                {
                    "name": "externalId",
                    "schema": {
                        "type": "string"
                    }
                },
                {
                    "name": "termsID",
                    "schema": {
                        "type": "string"
                    }
                }
            ],
            "returns": []
        },
        {
            "name": "CheckPackageDetailsAndPIIHash",
            "pathname": "",
            "description": "Compute and compare the SHA-256 hash of stored (salt, PackageDetails, PII) against expectedHash.",
            "params": [
                {
                    "name": "externalId",
                    "schema": {
                        "type": "string"
                    }
                },
                {
                    "name": "expectedHash",
                    "schema": {
                        "type": "string"
                    }
                }
            ],
            "returns": [
                {
                    "name": "",
                    "schema": {
                        "type": "boolean"
                    }
                }
            ]
        },
        {
            "name": "AcceptTransfer",
            "pathname": "",
            "description": "Accept a transfer for a package. Only the recipient org (toMSP) may accept. Requires matching 'transferTerms' in transient.",
            "params": [
                {
                    "name": "externalId",
                    "schema": {
                        "type": "string"
                    }
                },
                {
                    "name": "termsID",
                    "schema": {
                        "type": "string"
                    }
                }
            ],
            "returns": []
        },
        {
            "name": "ExecuteTransfer",
            "pathname": "",
            "description": "Execute the transfer of ownership for a package. Only the current owner org may execute after acceptance by the recipient org. Requires 'storeObject' in transient.",
            "params": [
                {
                    "name": "externalId",
                    "schema": {
                        "type": "string"
                    }
                },
                {
                    "name": "termsID",
                    "schema": {
                        "type": "string"
                    }
                }
            ],
            "returns": []
        },
        {
            "name": "TransferToPM3",
            "pathname": "",
            "description": "Transfer ownership of a package to PM3. Only the current owner org (which is the reciepient org in this case) may transfer to PM3.",
            "params": [
                {
                    "name": "externalId",
                    "schema": {
                        "type": "string"
                    }
                }
            ],
            "returns": []
        }
    ],
    "events": [
        {
            "name": "CreatePackage",
            "description": "Emitted on package creation",
            "details": {
                "type": "object",
                "properties": {
                    "externalId": {
                        "type": "string"
                    },
                    "ownerOrgMSP": {
                        "type": "string"
                    },
                    "status": {
                        "type": "string",
                        "enum": [
                            "pending",
                            "ready_for_pickup",
                            "picked_up",
                            "in_transit",
                            "delivered",
                            "succeeded",
                            "failed",
                            "proposed"
                        ]
                    },
                    "recipientOrgMSP": {
                        "type": "string"
                    },
                    "senderOrgMSP": {
                        "type": "string"
                    },
                    "packageDetailsAndPIIHash": {
                        "type": "string"
                    },
                    "caller": {
                        "type": "string"
                    }
                }
            }
        },
        {
            "name": "StatusUpdated",
            "description": "Emitted when status changes",
            "details": {
                "type": "object",
                "properties": {
                    "externalId": {
                        "type": "string"
                    },
                    "status": {
                        "type": "string",
                        "enum": [
                            "pending",
                            "ready_for_pickup",
                            "picked_up",
                            "in_transit",
                            "delivered",
                            "succeeded",
                            "failed",
                            "proposed"
                        ]
                    },
                    "caller": {
                        "type": "string"
                    }
                }
            }
        },
        {
            "name": "DeletePackage",
            "description": "Emitted on delete",
            "details": {
                "type": "object",
                "properties": {
                    "externalId": {
                        "type": "string"
                    },
                    "status": {
                        "type": "string",
                        "enum": [
                            "pending",
                            "ready_for_pickup",
                            "picked_up",
                            "in_transit",
                            "delivered",
                            "succeeded",
                            "failed",
                            "proposed"
                        ]
                    },
                    "caller": {
                        "type": "string"
                    }
                }
            }
        },
        {
            "name": "StatusUpdatedAfterPropose",
            "description": "Emitted when package status is updated to PROPOSED after proposing a transfer",
            "details": {
                "type": "object",
                "properties": {
                    "externalId": {
                        "type": "string"
                    },
                    "termsID": {
                        "type": "string"
                    },
                    "toMSP": {
                        "type": "string"
                    },
                    "expiryISO": {
                        "type": "string"
                    },
                    "status": {
                        "type": "string",
                        "enum": [
                            "pending",
                            "ready_for_pickup",
                            "picked_up",
                            "in_transit",
                            "delivered",
                            "succeeded",
                            "failed",
                            "proposed"
                        ]
                    },
                    "caller": {
                        "type": "string"
                    }
                }
            }
        },
        {
            "name": "StatusUpdatedAfterAccept",
            "description": "Emitted when package status is updated to READY_FOR_PICKUP after accepting a transfer",
            "details": {
                "type": "object",
                "properties": {
                    "externalId": {
                        "type": "string"
                    },
                    "termsID": {
                        "type": "string"
                    },
                    "status": {
                        "type": "string",
                        "enum": [
                            "pending",
                            "ready_for_pickup",
                            "picked_up",
                            "in_transit",
                            "delivered",
                            "succeeded",
                            "failed",
                            "proposed"
                        ]
                    },
                    "caller": {
                        "type": "string"
                    }
                }
            }
        },
        {
            "name": "TransferExecuted",
            "description": "Emitted when a transfer is executed",
            "details": {
                "type": "object",
                "properties": {
                    "externalId": {
                        "type": "string"
                    },
                    "termsId": {
                        "type": "string"
                    },
                    "newOwner": {
                        "type": "string"
                    },
                    "caller": {
                        "type": "string"
                    }
                }
            }
        },
        {
            "name": "TransferToPM3",
            "description": "Emitted when a package is transferred to PM3",
            "details": {
                "type": "object",
                "properties": {
                    "externalId": {
                        "type": "string"
                    }
                }
            }
        }
    ]
}
